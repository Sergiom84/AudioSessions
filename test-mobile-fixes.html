<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mobile Fixes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background: #111;
            color: white;
            font-size: 16px;
        }
        .test-container {
            max-width: 100%;
        }
        .fix-section {
            background: #222;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #333;
        }
        .fix-section.success {
            border-color: #00ff88;
        }
        .fix-section.error {
            border-color: #ff6b6b;
        }
        .test-btn {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: black;
            border: none;
            padding: 15px 20px;
            margin: 10px 5px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
            min-width: 140px;
        }
        .test-btn:active {
            background: linear-gradient(135deg, #00cc66, #00aa55);
            transform: scale(0.95);
        }
        .status {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .success { color: #6bcf7f; }
        .error { color: #ff6b6b; }
        .warn { color: #ffd93d; }
        .info { color: #74c0fc; }
        .device-info {
            background: #000;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Test Mobile Fixes</h1>
        
        <div class="device-info" id="deviceInfo">
            <h3>üì± Informaci√≥n del Dispositivo</h3>
            <p>Cargando...</p>
        </div>
        
        <div class="fix-section" id="downloadFix">
            <h3>üì• Fix 1: Bot√≥n de Descarga</h3>
            <p><strong>Problema:</strong> No funcionaba en Android/iPhone</p>
            <p><strong>Soluci√≥n:</strong> touchHandled flag + fallback click + enlace modal</p>

            <button class="test-btn" onclick="testDownloadFix()">üß™ Test Descarga</button>
            <button class="test-btn" onclick="goToDownloadPage()">üìÑ Ir a P√°gina</button>

            <div class="status" id="downloadStatus">
                Haz click en "Test Descarga" para probar
            </div>
        </div>
        
        <div class="fix-section" id="playerFix">
            <h3>üéÆ Fix 2: Controles del Reproductor</h3>
            <p><strong>Problema:</strong> Pause, Stop, Rewind, Forward no funcionaban en Android</p>
            <p><strong>Soluci√≥n:</strong> btn.click() en touchend events</p>
            
            <button class="test-btn" onclick="testPlayerFix()">üéµ Test Reproductor</button>
            <button class="test-btn" onclick="goToPlayerPage()">üéß Ir a Player</button>
            
            <div class="status" id="playerStatus">
                Haz click en "Test Reproductor" para probar
            </div>
        </div>
        
        <div class="fix-section" id="touchFix">
            <h3>üëÜ Fix 3: Eventos T√°ctiles</h3>
            <p><strong>Problema:</strong> Eventos duplicados y falta de feedback</p>
            <p><strong>Soluci√≥n:</strong> preventDefault + visual feedback</p>
            
            <button class="test-btn" onclick="testTouchEvents()">‚úã Test Touch</button>
            <button class="test-btn" onclick="simulateTouchEvents()">ü§ñ Simular Touch</button>
            
            <div class="status" id="touchStatus">
                Haz click en "Test Touch" para probar
            </div>
        </div>
        
        <div class="fix-section">
            <h3>üß™ Tests Espec√≠ficos por Sesi√≥n</h3>
            
            <button class="test-btn" onclick="testSession('plastic')">üìÄ Plastic</button>
            <button class="test-btn" onclick="testSession('first-date-vol-ii')">üè† First Date</button>
            <button class="test-btn" onclick="testSession('nature-tech-house')">üî• Nature</button>
            <button class="test-btn" onclick="testSession('insane')">üéß Insane</button>
            
            <div class="status" id="sessionStatus">
                Selecciona una sesi√≥n para probar
            </div>
        </div>
        
        <div class="fix-section">
            <h3>üìã Logs de Actividad</h3>
            <div class="status" id="activityLogs" style="max-height: 200px; overflow-y: auto;">
                <strong>Logs:</strong><br>
            </div>
            <button class="test-btn" onclick="clearLogs()">üóëÔ∏è Limpiar</button>
            <button class="test-btn" onclick="exportLogs()">üíæ Exportar</button>
        </div>
    </div>

    <script>
        let logs = [];
        
        function addLog(type, message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { timestamp, type, message, data };
            logs.push(logEntry);
            
            if (logs.length > 50) {
                logs.shift();
            }
            
            updateLogDisplay();
            console.log(`[${type}] ${message}`, data || '');
        }
        
        function updateLogDisplay() {
            const container = document.getElementById('activityLogs');
            const lastLogs = logs.slice(-10);
            
            container.innerHTML = '<strong>Logs:</strong><br>' + 
                lastLogs.map(log => 
                    `<div class="${log.type.toLowerCase()}">
                        [${log.timestamp}] ${log.type}: ${log.message}
                        ${log.data ? '<br><small>' + JSON.stringify(log.data, null, 2) + '</small>' : ''}
                    </div>`
                ).join('');
            
            container.scrollTop = container.scrollHeight;
        }
        
        // Detectar informaci√≥n del dispositivo
        document.addEventListener('DOMContentLoaded', () => {
            const deviceInfo = {
                userAgent: navigator.userAgent,
                isAndroid: /Android/i.test(navigator.userAgent),
                isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
                isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                         (navigator.maxTouchPoints && navigator.maxTouchPoints > 0) ||
                         'ontouchstart' in window,
                touchSupport: 'ontouchstart' in window,
                maxTouchPoints: navigator.maxTouchPoints,
                audioSupport: !!window.Audio
            };
            
            document.getElementById('deviceInfo').innerHTML = `
                <h3>üì± Informaci√≥n del Dispositivo</h3>
                <p><strong>Android:</strong> ${deviceInfo.isAndroid ? '‚úÖ S√≠' : '‚ùå No'}</p>
                <p><strong>iOS:</strong> ${deviceInfo.isIOS ? '‚úÖ S√≠' : '‚ùå No'}</p>
                <p><strong>M√≥vil:</strong> ${deviceInfo.isMobile ? '‚úÖ S√≠' : '‚ùå No'}</p>
                <p><strong>Touch:</strong> ${deviceInfo.touchSupport ? '‚úÖ S√≠' : '‚ùå No'}</p>
                <p><strong>Touch Points:</strong> ${deviceInfo.maxTouchPoints}</p>
                <p><strong>Audio:</strong> ${deviceInfo.audioSupport ? '‚úÖ S√≠' : '‚ùå No'}</p>
            `;
            
            addLog('INIT', 'Test de fixes m√≥viles iniciado', deviceInfo);
        });
        
        // Funciones de prueba
        function testDownloadFix() {
            addLog('TEST', 'Probando fix del bot√≥n de descarga');
            document.getElementById('downloadStatus').innerHTML = `
                <strong>Fix aplicado:</strong> ‚úÖ<br>
                <strong>touchHandled flag:</strong> Implementado<br>
                <strong>Fallback click:</strong> Configurado<br>
                <strong>Enlace modal:</strong> Eventos click/touch agregados<br>
                <strong>window.open():</strong> Configurado para m√≥viles<br>
                <strong>Estado:</strong> <span class="success">Listo para probar</span>
            `;
            document.getElementById('downloadFix').className = 'fix-section success';
        }
        
        function testPlayerFix() {
            addLog('TEST', 'Probando fix de controles del reproductor');
            document.getElementById('playerStatus').innerHTML = `
                <strong>Fix aplicado:</strong> ‚úÖ<br>
                <strong>btn.click() en touchend:</strong> Implementado<br>
                <strong>Controles:</strong> Play/Pause, Stop, Rewind, Forward<br>
                <strong>Estado:</strong> <span class="success">Listo para probar</span>
            `;
            document.getElementById('playerFix').className = 'fix-section success';
        }
        
        function testTouchEvents() {
            addLog('TEST', 'Probando eventos t√°ctiles mejorados');
            document.getElementById('touchStatus').innerHTML = `
                <strong>Fix aplicado:</strong> ‚úÖ<br>
                <strong>preventDefault:</strong> Configurado<br>
                <strong>Visual feedback:</strong> Implementado<br>
                <strong>Estado:</strong> <span class="success">Eventos optimizados</span>
            `;
            document.getElementById('touchFix').className = 'fix-section success';
        }
        
        function simulateTouchEvents() {
            addLog('TEST', 'Simulando eventos t√°ctiles');
            if ('ontouchstart' in window) {
                addLog('SUCCESS', 'Soporte t√°ctil detectado - eventos disponibles');
            } else {
                addLog('WARN', 'No hay soporte t√°ctil - usando eventos click');
            }
        }
        
        function testSession(sessionId) {
            addLog('TEST', `Probando sesi√≥n: ${sessionId}`);
            const url = `player.html?session=${sessionId}`;
            document.getElementById('sessionStatus').innerHTML = `
                <strong>Sesi√≥n:</strong> ${sessionId}<br>
                <strong>URL:</strong> ${url}<br>
                <strong>Estado:</strong> <span class="info">Redirigiendo...</span>
            `;
            
            setTimeout(() => {
                window.location.href = url;
            }, 1000);
        }
        
        function goToDownloadPage() {
            addLog('INFO', 'Redirigiendo a test de descarga');
            window.location.href = 'test-mobile-download.html';
        }
        
        function goToPlayerPage() {
            addLog('INFO', 'Redirigiendo a test de reproductor');
            window.location.href = 'test-android-complete.html';
        }
        
        function clearLogs() {
            logs = [];
            updateLogDisplay();
            addLog('INFO', 'Logs limpiados');
        }
        
        function exportLogs() {
            const logsText = JSON.stringify(logs, null, 2);
            if (navigator.clipboard) {
                navigator.clipboard.writeText(logsText).then(() => {
                    addLog('SUCCESS', 'Logs copiados al clipboard');
                }).catch(() => {
                    addLog('WARN', 'No se pudo copiar al clipboard');
                });
            } else {
                addLog('INFO', 'Logs preparados para exportar', { size: logsText.length });
            }
        }
        
        // Interceptar eventos para logging
        document.addEventListener('touchstart', (e) => {
            if (e.target.classList.contains('test-btn')) {
                addLog('TOUCH', 'Touch start detectado', { target: e.target.textContent.trim() });
            }
        }, { passive: true });
        
        document.addEventListener('touchend', (e) => {
            if (e.target.classList.contains('test-btn')) {
                addLog('TOUCH', 'Touch end detectado', { target: e.target.textContent.trim() });
            }
        }, { passive: true });
    </script>
</body>
</html>
