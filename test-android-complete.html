<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Completo Android</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: #000;
            color: #00ff88;
            font-size: 14px;
        }
        .test-section {
            background: #111;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }
        .test-btn {
            background: #00ff88;
            color: black;
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            touch-action: manipulation;
            min-width: 120px;
        }
        .test-btn:active {
            background: #00cc66;
            transform: scale(0.95);
        }
        .status {
            background: #222;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: #6bcf7f; }
        .error { color: #ff6b6b; }
        .warn { color: #ffd93d; }
        .info { color: #74c0fc; }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        #globalPlayer {
            border: 2px solid #00ff88 !important;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>üîß Test Completo Android</h2>
    
    <div class="test-section">
        <h3>üì± Estado del Dispositivo</h3>
        <div id="deviceStatus" class="status">Detectando...</div>
    </div>
    
    <div class="test-section">
        <h3>üéµ Cargar Sesi√≥n de Prueba</h3>
        <div class="controls-grid">
            <button class="test-btn" onclick="loadTestSession()">üéß Cargar Audio</button>
            <button class="test-btn" onclick="loadHouseSession()">üè† House Session</button>
            <button class="test-btn" onclick="loadTechnoSession()">üî• Techno Session</button>
        </div>
    </div>

    <div class="test-section">
        <h3>üì• Test Bot√≥n Descarga</h3>
        <div class="controls-grid">
            <button class="test-btn" onclick="testDownloadButton()">üì• Test Descarga</button>
            <button class="test-btn" onclick="goToDownloadTest()">üì± P√°gina Test</button>
        </div>
        <div class="status" id="downloadStatus">Carga una sesi√≥n con descarga para probar</div>
    </div>
    
    <div class="test-section">
        <h3>‚èØÔ∏è Controles de Reproducci√≥n</h3>
        <div class="controls-grid">
            <button class="test-btn" onclick="testPlay()">‚ñ∂Ô∏è Play</button>
            <button class="test-btn" onclick="testPause()">‚è∏Ô∏è Pause</button>
            <button class="test-btn" onclick="testStop()">‚èπÔ∏è Stop</button>
            <button class="test-btn" onclick="testToggle()">üîÑ Toggle</button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>‚è≠Ô∏è Controles de Navegaci√≥n</h3>
        <div class="controls-grid">
            <button class="test-btn" onclick="testSeekStart()">‚èÆÔ∏è Inicio</button>
            <button class="test-btn" onclick="testSeekBack()">‚è™ -10s</button>
            <button class="test-btn" onclick="testSeekForward()">‚è© +10s</button>
            <button class="test-btn" onclick="testSeekMiddle()">‚è≠Ô∏è Medio</button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>üìä Estado del Reproductor</h3>
        <div id="playerStatus" class="status">No hay audio cargado</div>
    </div>
    
    <div class="test-section">
        <h3>üìã Logs de Actividad</h3>
        <div class="controls-grid">
            <button class="test-btn" onclick="showLogs()">üìã Ver Logs</button>
            <button class="test-btn" onclick="clearLogs()">üóëÔ∏è Limpiar</button>
            <button class="test-btn" onclick="exportLogs()">üíæ Exportar</button>
        </div>
        <div id="activityLogs" class="status" style="max-height: 200px; overflow-y: auto;"></div>
    </div>

    <script src="global-player-simple.js"></script>
    <script>
        let testLogs = [];
        
        function addLog(type, message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { timestamp, type, message, data };
            testLogs.push(logEntry);
            
            if (testLogs.length > 50) {
                testLogs.shift();
            }
            
            updateLogDisplay();
            console.log(`[${type}] ${message}`, data || '');
        }
        
        function updateLogDisplay() {
            const container = document.getElementById('activityLogs');
            const lastLogs = testLogs.slice(-10);
            
            container.innerHTML = lastLogs.map(log => 
                `<div class="${log.type.toLowerCase()}">
                    [${log.timestamp}] ${log.type}: ${log.message}
                    ${log.data ? '<br><small>' + JSON.stringify(log.data, null, 2) + '</small>' : ''}
                </div>`
            ).join('');
            
            container.scrollTop = container.scrollHeight;
        }
        
        function updatePlayerStatus() {
            const status = document.getElementById('playerStatus');
            if (window.globalPlayer && window.globalPlayer.audio) {
                const audio = window.globalPlayer.audio;
                status.innerHTML = `
                    <strong>Audio:</strong> ${window.globalPlayer.currentSession ? window.globalPlayer.currentSession.title : 'Sin t√≠tulo'}<br>
                    <strong>Estado:</strong> ${window.globalPlayer.isPlaying ? 'Reproduciendo' : 'Pausado'}<br>
                    <strong>Tiempo:</strong> ${audio.currentTime ? audio.currentTime.toFixed(1) : 0}s / ${audio.duration ? audio.duration.toFixed(1) : 0}s<br>
                    <strong>Ready State:</strong> ${audio.readyState}<br>
                    <strong>Interacci√≥n:</strong> ${window.globalPlayer.userInteracted ? 'S√≠' : 'No'}
                `;
            } else {
                status.innerHTML = 'No hay audio cargado';
            }
        }
        
        // Detectar informaci√≥n del dispositivo
        document.addEventListener('DOMContentLoaded', () => {
            const deviceInfo = {
                userAgent: navigator.userAgent,
                isAndroid: /Android/i.test(navigator.userAgent),
                isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
                isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                touchSupport: 'ontouchstart' in window,
                maxTouchPoints: navigator.maxTouchPoints,
                audioSupport: !!window.Audio,
                mediaSessionSupport: 'mediaSession' in navigator
            };
            
            document.getElementById('deviceStatus').innerHTML = `
                <strong>Android:</strong> ${deviceInfo.isAndroid ? '‚úÖ' : '‚ùå'} | 
                <strong>iOS:</strong> ${deviceInfo.isIOS ? '‚úÖ' : '‚ùå'} | 
                <strong>M√≥vil:</strong> ${deviceInfo.isMobile ? '‚úÖ' : '‚ùå'}<br>
                <strong>Touch:</strong> ${deviceInfo.touchSupport ? '‚úÖ' : '‚ùå'} | 
                <strong>Audio:</strong> ${deviceInfo.audioSupport ? '‚úÖ' : '‚ùå'} | 
                <strong>MediaSession:</strong> ${deviceInfo.mediaSessionSupport ? '‚úÖ' : '‚ùå'}<br>
                <strong>Touch Points:</strong> ${deviceInfo.maxTouchPoints}
            `;
            
            addLog('INFO', 'Dispositivo detectado', deviceInfo);
            
            // Actualizar estado cada segundo
            setInterval(updatePlayerStatus, 1000);
        });
        
        // Funciones de prueba
        function loadTestSession() {
            addLog('TEST', 'Cargando sesi√≥n de prueba');
            const session = {
                title: 'Test MP3 Android',
                audio_url: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3'
            };
            
            if (window.globalPlayer) {
                window.globalPlayer.loadSession(session);
                addLog('SUCCESS', 'Sesi√≥n cargada', { title: session.title });
            } else {
                addLog('ERROR', 'GlobalPlayer no disponible');
            }
        }
        
        function loadHouseSession() {
            addLog('TEST', 'Cargando sesi√≥n House');
            const session = {
                title: 'First Date Vol.II',
                audio_url: 'https://archive.org/download/first-date-vol.-ii/First%20Date%20Vol.II.mp3'
            };
            
            if (window.globalPlayer) {
                window.globalPlayer.loadSession(session);
                addLog('SUCCESS', 'Sesi√≥n House cargada');
            } else {
                addLog('ERROR', 'GlobalPlayer no disponible');
            }
        }
        
        function loadTechnoSession() {
            addLog('TEST', 'Cargando sesi√≥n Techno');
            const session = {
                title: 'Nature Tech House',
                audio_url: 'https://archive.org/download/nature-club/Nature%20Club.mp3'
            };
            
            if (window.globalPlayer) {
                window.globalPlayer.loadSession(session);
                addLog('SUCCESS', 'Sesi√≥n Techno cargada');
            } else {
                addLog('ERROR', 'GlobalPlayer no disponible');
            }
        }
        
        function testPlay() {
            addLog('TEST', 'Probando Play');
            if (window.globalPlayer && window.globalPlayer.audio) {
                window.globalPlayer.play();
                addLog('SUCCESS', 'Play ejecutado');
            } else {
                addLog('ERROR', 'No hay audio para reproducir');
            }
        }
        
        function testPause() {
            addLog('TEST', 'Probando Pause');
            if (window.globalPlayer && window.globalPlayer.audio) {
                window.globalPlayer.pause();
                addLog('SUCCESS', 'Pause ejecutado');
            } else {
                addLog('ERROR', 'No hay audio para pausar');
            }
        }
        
        function testStop() {
            addLog('TEST', 'Probando Stop');
            if (window.globalPlayer && window.globalPlayer.audio) {
                window.globalPlayer.stop();
                addLog('SUCCESS', 'Stop ejecutado');
            } else {
                addLog('ERROR', 'No hay audio para detener');
            }
        }
        
        function testToggle() {
            addLog('TEST', 'Probando Toggle Play/Pause');
            if (window.globalPlayer && window.globalPlayer.audio) {
                window.globalPlayer.togglePlay();
                addLog('SUCCESS', 'Toggle ejecutado');
            } else {
                addLog('ERROR', 'No hay audio para toggle');
            }
        }
        
        function testSeekStart() {
            addLog('TEST', 'Probando Seek al inicio');
            if (window.globalPlayer && window.globalPlayer.audio) {
                window.globalPlayer.seekTo(0);
                addLog('SUCCESS', 'Seek al inicio ejecutado');
            } else {
                addLog('ERROR', 'No hay audio para seek');
            }
        }
        
        function testSeekBack() {
            addLog('TEST', 'Probando Seek -10s');
            if (window.globalPlayer && window.globalPlayer.audio) {
                window.globalPlayer.seekRelative(-10);
                addLog('SUCCESS', 'Seek -10s ejecutado');
            } else {
                addLog('ERROR', 'No hay audio para seek');
            }
        }
        
        function testSeekForward() {
            addLog('TEST', 'Probando Seek +10s');
            if (window.globalPlayer && window.globalPlayer.audio) {
                window.globalPlayer.seekRelative(10);
                addLog('SUCCESS', 'Seek +10s ejecutado');
            } else {
                addLog('ERROR', 'No hay audio para seek');
            }
        }
        
        function testSeekMiddle() {
            addLog('TEST', 'Probando Seek al medio');
            if (window.globalPlayer && window.globalPlayer.audio && window.globalPlayer.audio.duration) {
                const middleTime = window.globalPlayer.audio.duration / 2;
                window.globalPlayer.seekTo(middleTime);
                addLog('SUCCESS', 'Seek al medio ejecutado', { time: middleTime });
            } else {
                addLog('ERROR', 'No hay audio con duraci√≥n para seek');
            }
        }
        
        function showLogs() {
            if (window.globalPlayer && window.globalPlayer.getLogs) {
                const playerLogs = window.globalPlayer.getLogs();
                addLog('INFO', 'Logs del reproductor obtenidos', { count: playerLogs.length });
                
                // Mostrar √∫ltimos 5 logs del reproductor
                const lastPlayerLogs = playerLogs.slice(-5);
                lastPlayerLogs.forEach(log => {
                    addLog('PLAYER', `${log.type}: ${log.message}`, log.data);
                });
            } else {
                addLog('WARN', 'No hay logs del reproductor disponibles');
            }
        }
        
        function clearLogs() {
            testLogs = [];
            if (window.globalPlayer && window.globalPlayer.logs) {
                window.globalPlayer.logs = [];
            }
            updateLogDisplay();
            addLog('INFO', 'Logs limpiados');
        }
        
        function testDownloadButton() {
            addLog('TEST', 'Probando bot√≥n de descarga');
            const downloadBtn = document.getElementById('downloadBtn');
            const downloadStatus = document.getElementById('downloadStatus');

            if (downloadBtn) {
                downloadStatus.innerHTML = `
                    <strong>Bot√≥n encontrado:</strong> ‚úÖ<br>
                    <strong>Visible:</strong> ${downloadBtn.style.display !== 'none' ? '‚úÖ' : '‚ùå'}<br>
                    <strong>Eventos:</strong> Verificando...
                `;

                // Simular touch en el bot√≥n
                if ('ontouchstart' in window) {
                    const touchStart = new TouchEvent('touchstart', { bubbles: true });
                    const touchEnd = new TouchEvent('touchend', { bubbles: true });

                    downloadBtn.dispatchEvent(touchStart);
                    setTimeout(() => {
                        downloadBtn.dispatchEvent(touchEnd);
                        addLog('SUCCESS', 'Eventos touch simulados en bot√≥n descarga');
                    }, 100);
                } else {
                    downloadBtn.click();
                    addLog('SUCCESS', 'Click simulado en bot√≥n descarga');
                }
            } else {
                downloadStatus.innerHTML = '<strong>Bot√≥n NO encontrado:</strong> ‚ùå<br>Carga una sesi√≥n con descarga primero';
                addLog('ERROR', 'Bot√≥n de descarga no encontrado');
            }
        }

        function goToDownloadTest() {
            addLog('INFO', 'Redirigiendo a p√°gina de test de descarga m√≥vil');
            window.location.href = 'test-mobile-download.html';
        }

        function exportLogs() {
            const allLogs = {
                testLogs: testLogs,
                playerLogs: window.globalPlayer ? window.globalPlayer.getLogs() : [],
                deviceInfo: {
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString()
                }
            };

            const logsText = JSON.stringify(allLogs, null, 2);

            if (navigator.clipboard) {
                navigator.clipboard.writeText(logsText).then(() => {
                    addLog('SUCCESS', 'Logs copiados al clipboard');
                }).catch(() => {
                    addLog('WARN', 'No se pudo copiar al clipboard');
                });
            } else {
                addLog('INFO', 'Logs preparados para exportar', { size: logsText.length });
            }
        }
    </script>
</body>
</html>
